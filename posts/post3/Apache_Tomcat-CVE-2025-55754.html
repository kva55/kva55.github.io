<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Template - Elysee Franchuk (kva55)</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #333;
            color: #fff;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #222;
            padding: 1em 0;
            text-align: center;
        }
        header h1 {
            margin: 0;
            font-size: 2em;
        }
        nav {
            display: flex;
            justify-content: center;
            background-color: #444;
            padding: 0.5em 0;
        }
        nav a {
            color: #ddd;
            text-decoration: none;
            padding: 0.5em 1em;
            margin: 0 0.5em;
            background-color: #555;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        nav a:hover {
            background-color: #666;
        }
        main {
            margin: 2em auto;
            max-width: 800px;
            padding: 2em;
            background: #444;
            border-radius: 8px;
            box-sizing: border-box;
        }
        h2, h3, h4 {
            color: #ffcc00;
			margin: 1em auto;
            display: block;
			max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        p {
            line-height: 1.6;
            margin: 1em 0;
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 1em 0;
        }
        pre {
            background-color: #222;
            padding: 1em;
            border-radius: 8px;
            overflow-x: auto;
            color: #ddd;
        }
        code {
            font-family: 'Courier New', monospace;
            background-color: #555;
            padding: 0.2em 0.4em;
            border-radius: 4px;
            color: #ffcc00;
        }
        blockquote {
            border-left: 4px solid #ffcc00;
            margin: 1em 0;
            padding: 0.5em 1em;
            background-color: #555;
            color: #ddd;
        }
        ul, ol {
            margin: 1em 0;
            padding-left: 1.5em;
        }
        ul li, ol li {
            margin: 0.5em 0;
        }
        footer {
            background-color: #222;
            text-align: center;
            padding: 1.5em 0;
        }
		img {
            max-width: 60%;
            height: auto;
            border-radius: 8px;
            margin: 1em auto;
            display: block;
        }
		
		.img2 {
            max-width:90%;
            height: auto;
            border-radius: 8px;
            margin: 1em auto;
            display: block;
        }
		a {
            color: #ffcc00;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <h1> Elysee Franchuk <span style="font-size: 0.8em;">- Elysee Franchuk (kva55)</span></h1>
    </header>

    <!-- Navigation -->
    <nav>
        <a href="/index.html">About</a>
        <a href="/blog.html">Blogs</a>
        <a href="/contact.html">Contact</a>
    </nav>

    <!-- Main Content -->
    <main>
		<img src="front_pic.png" alt="Placeholder image" style="width: 140%; display: block; margin: 0 auto;">
        <h2>Where ANSI-Escape Sequences and RCE Converges - CVE-2025-55754</h2>
        <p>This quick write-up will be on a vulnerability I encountered on Apache Tomcat. 
		Basically, the vulnerability exists when the Apache Tomcat instance is run as a binary from command-line, opposed to being a service.<br><br>
		I won't be discussing how common this configuration is, since this shouldn't happen in prodction environments. <a href="https://lists.apache.org/thread/j7w54hqbkfcn0xb9xy0wnx8w5nymcbqd"> Linked here </a> is the official 
		statement by the Apache Tomcat development team.<br><br>
		On the otherhand, this CVE has a CVSS rating of 9.6 if the server runs as a binary. The goal of this post will be to demonstrate the exploitation
		process that can lead to RCE (with user-interaction).<br><br>
		<b>Important Note:</b> This PoC is based on one attack vector, and others may exist which may not even require the server to run as a binary.</b>
		</p>

        <h3>Lets Perform Some ANSI-Escapes!</h3>
        <p>The way I understand <a href="https://cwe.mitre.org/data/definitions/150.html"> ANSI-Escape sequences </a> is they're instructions that terminals / console windows undersand.
		These sequences can appear in the terminal, or in log files. When these sequences are processed in the context of the console window,
		the terminal can perform some code execution such as:
		<ul>
            <li>Window Title Change</li>
            <li>Text/Background Colour Change</li>
            <li>Bell Rings</li>
			<li>Buffer Insertion / Data Append</li>
			<li>Clipboard Injection</li>
        </ul>
		<br>
		Another way to think of this, would be like HTML-tags, when processed by a browser can render and output html-specific out. Instead, these instructions are interpreted by the console window.
		<br>
		For a more complete list of ANSI-escape squences, Connor Will documented them <a href="https://gist.github.com/ConnerWill/d4b6c776b509add763e17f9f113fd25b"> here </a>
		</p>
		<br>
		<p> Now, lets locate the binary for Apache, which we will run from command-line.</p>
		<img src="binary.png" alt="Placeholder image" class="img2">
		<p> Lets run the binary. <b>Heads up</b>, if the terminal is run as administrator, any code entered in the terminal will be in a privileged session.</p>
		<img src="cli_1.png" alt="Placeholder image" class="img2">
		
		<p>The next step is a simple ASNI-Escape Sequence that will overwrite the tab name.</p>
		<code>http://10.10.10.10:8080/a/%1B%5D0%3BServer%20Error%07/a.</code>
		<p>Lets break this down a little. The actual injection occurs after the first directory <code>/a/</code>, and before the last canonical file name <code>/a.</code></p>
		<code>\x1B ] 0 ; Server Error \x07</code>
		<ul>
            <li><code>ESC ]</code> is <code>%1B</code> that is the beginning of the OSC (Operating system Command)</li>
            <li><code>0</code> is tells the terminal the window title will be changed</li>
			<li><code>;</code> seperates the command from the payload</li>
			<li><code>Server Error</code> is the malicious input (You can think of this as the pre-text)</li>
			<li><code>BEL</code> is the code <code>%07</code> that terminates the sequence</li>
        </ul>
		
		<img src="get_req1.png" alt="Placeholder image" class="img2">
        
		<p> Below, we can see the tab name is changed on our server! This occurs because we are searching for files conanical name <code>/a.</code>, but since we didn't append a file extension, it causes an error.
		Thus, the payload is brought into the console, causing the injection to be processed.</p>
		<img src="cli_2.png" alt="Placeholder image" class="img2">
		
		<h3>Pushing ANSI-Escapes to Their Limit</h3>
        <p> So, we know we can perform some ANSI-Escape Sequences that control the tab names, terminal-contents, and even overwrite the clipboard. </p>
		<p> If we combine these into an attack, malicious instructions can be sent onto the screen, while implanting a reverse-shell payload into the clipboard.
		If the Apache process is turned off with <code>CTRL+C</code>, and then <code>CTRL+V</code> is pressed, the clipboard with payload containing newlines can be executed in the window.</p>
		
		<p><b>Note:</b> The newlines can be ommitted to prevent a PowerShell warning from popping up, but then an additional <code>ENTER</code> key needs to be pressed. Stealthier, but extra steps.</p>
		
		<p> This PoC script can be found on my <a href="https://github.com/kva55/CVEs/blob/main/CVE-2025-55754/cve-2025-55754.sh"> github.</a> For ease of use, the main arguments are the ip/hostname plus the port.
		Within the script, the <code>RAW_COMMAND</code> variable can be changed to whatever commands are required. </p>
		<img src="script_1.png" alt="Placeholder image" class="img2">
		<img src="script_2.png" alt="Placeholder image" class="img2">
		
		<p> Next, we see the injection with the tab name, and terminal contents injected. In the background, the script implanted the command in the clipboard. </p>
		<img src="cli_3.png" alt="Placeholder image" class="img2">
		
		<p> If the instructions are followed, we can see powershell is giving a warning. This can be removed, by excluding the newline character in the <code>RAW_COMMAND</code> variable. But doing so, will require the user to press <code>ENTER</code>. </p>
		<img src="cli_4.png" alt="Placeholder image" class="img2">
		
		<p> Finally, we see notepad open. Wicked.</p>
		<img src="cli_5.png" alt="Placeholder image" class="img2">
        
		<p> This about sums it up. I had some discussions with coworkers, and friends before and during the disclosure of this finding. I'm a bit surprised with it's CVSS score, but as all things, the real impact is not
		necessarily reflected in the score. On the otherhand, if similar attack vectors, or more streamlined attacks exist for findings like this it's important to catch them.
		
		<h4>References</h4>
        <ul>
                <li><a href="https://www.cve.org/CVERecord?id=CVE-2025-55754">https://www.cve.org/CVERecord?id=CVE-2025-55754</a></li>
        </ul>
		
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 <strong>Elysee Franchuk</strong> (kva55). All rights reserved.</p>
    </footer>
</body>
</html>
